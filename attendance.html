<!doctype html>
<!-- The DOCTYPE declaration above will set the     -->
<!-- browser's rendering engine into                -->
<!-- "Standards Mode". Replacing this declaration   -->
<!-- with a "Quirks Mode" doctype is not supported. -->

<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Janusz BiaÅ‚obrzewski" />
    <!--                                                               -->
    <!-- Consider inlining CSS to reduce the number of requested files -->
    <!--                                                               -->
    <link type="text/css" rel="stylesheet" href="JsQRScanner.css">

    <!--                                           -->
    <!-- Any title is fine                         -->
    <!--                                           -->
    <title>Demandid | Attendance</title>

    <!--                                           -->
    <!-- This script loads your compiled module.   -->
    <script type="text/javascript" src="jsPretty/jsqrscanner.nocache.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
</head>
<body>

<div class="row-element-set row-element-set-QRScanner">
    <!-- RECOMMENDED if your web app will not function without JavaScript enabled -->
    <noscript>
        <div class="row-element-set error_message">
            Your web browser must have JavaScript enabled
            in order for this application to display correctly.
        </div>
    </noscript>
    <div class="row-element-set error_message" id="secure-connection-message" style="display: none;" hidden >
        You may need to serve this page over a secure connection (https) to run JsQRScanner correctly.
    </div>
    <script>
        if (location.protocol != 'https:') {
            document.getElementById('secure-connection-message').style='display: block';
        }
    </script>

    <h1 class="mb-0 text-center">Attendance<svg  class="w-25 pb-2" id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><defs><style>.cls-1{fill:#141f38;}</style></defs><title>notepad-1-outline</title><path class="cls-1" d="M358.4,204.8a12.8,12.8,0,0,1-12.8,12.8h-128a12.8,12.8,0,1,1,0-25.6h128A12.8,12.8,0,0,1,358.4,204.8ZM166.4,192a12.8,12.8,0,1,0,12.8,12.8A12.8,12.8,0,0,0,166.4,192Zm179.2,51.2h-128a12.8,12.8,0,1,0,0,25.6h128a12.8,12.8,0,0,0,0-25.6Zm-179.2,0A12.8,12.8,0,1,0,179.2,256,12.8,12.8,0,0,0,166.4,243.2Zm179.2,51.2h-128a12.8,12.8,0,1,0,0,25.6h128a12.8,12.8,0,0,0,0-25.6Zm-179.2,0a12.8,12.8,0,1,0,12.8,12.8A12.8,12.8,0,0,0,166.4,294.4Zm179.2,51.2h-128a12.8,12.8,0,0,0,0,25.6h128a12.8,12.8,0,0,0,0-25.6Zm-179.2,0a12.8,12.8,0,1,0,12.8,12.8A12.8,12.8,0,0,0,166.4,345.6Zm179.2,51.2h-128a12.8,12.8,0,0,0,0,25.6h128a12.8,12.8,0,0,0,0-25.6Zm-179.2,0a12.8,12.8,0,1,0,12.8,12.8A12.8,12.8,0,0,0,166.4,396.8ZM460.8,102.4V448a64.19,64.19,0,0,1-64,64H115.2a64.19,64.19,0,0,1-64-64V102.4a64.19,64.19,0,0,1,64-64H173A31.89,31.89,0,0,1,198.4,25.6h21.43a38.35,38.35,0,0,1,72.34,0H313.6A31.89,31.89,0,0,1,339,38.4H396.8A64.19,64.19,0,0,1,460.8,102.4Zm-217.6-64A12.8,12.8,0,1,0,256,25.6,12.81,12.81,0,0,0,243.2,38.4ZM192,96a6.49,6.49,0,0,0,6.4,6.4H313.6A6.49,6.49,0,0,0,320,96V57.6a6.49,6.49,0,0,0-6.4-6.4H292.17a38.35,38.35,0,0,1-72.34,0H198.4a6.49,6.49,0,0,0-6.4,6.4Zm243.2,6.4A38.44,38.44,0,0,0,396.8,64H345.6V96a32.09,32.09,0,0,1-32,32H198.4a32.09,32.09,0,0,1-32-32V64H115.2a38.44,38.44,0,0,0-38.4,38.4V448a38.44,38.44,0,0,0,38.4,38.4H396.8A38.44,38.44,0,0,0,435.2,448Z"/></svg></h1>
    <hr id="hr-profile">

    <div class="lead text-center">Point the webcam to a QR code.</div>
    <br>
    <div class="row-element">
        <div class="qrscanner" id="scanner">
        </div>
    </div>
    <div class="row-element">
        <div class="mt-5 display-flex" id = "profileInformation">
            <div class="profile-card js-profile-card">
                <div class="profile-card__img">
                    <img src="img/avatar-svgrepo-com.svg" alt="profile card">
                </div>

                <div class="profile-card__cnt js-profile-cnt">
                    <div id="fullname" class="profile-card__name pb-0 mb-1">{{fullname}}</div>

                    <div class="text-black mt-0 pt-0 font-weight-bold">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 3v18h24v-18h-24zm6.623 7.929l-4.623 5.712v-9.458l4.623 3.746zm-4.141-5.929h19.035l-9.517 7.713-9.518-7.713zm5.694 7.188l3.824 3.099 3.83-3.104 5.612 6.817h-18.779l5.513-6.812zm9.208-1.264l4.616-3.741v9.348l-4.616-5.607z"/></svg>
                        <span id="email"> {{ email }}</span>
                    </div>
                    <hr>
                    <div class="profile-card__txt">Profession: <strong id="profession">{{ profession }}</strong></div>
                    <div class="profile-card__txt"> Next of Kin phone number: <strong id="nextOfKinPhoneNumber">{{ next_of_kin_phone_number }}</strong></div>
                </div>


                <!--              <div class="profile-card-inf">-->
                <!--                <div class="profile-card-inf__item">-->
                <!--                  <div class="profile-card-inf__title">1598</div>-->
                <!--                  <div class="profile-card-inf__txt">Followers</div>-->
                <!--                </div>-->

                <!--                <div class="profile-card-inf__item">-->
                <!--                  <div class="profile-card-inf__title">65</div>-->
                <!--                  <div class="profile-card-inf__txt">Following</div>-->
                <!--                </div>-->

                <!--                <div class="profile-card-inf__item">-->
                <!--                  <div class="profile-card-inf__title">123</div>-->
                <!--                  <div class="profile-card-inf__txt">Articles</div>-->
                <!--                </div>-->


            </div>

        </div>

    </div>

</div>


</div>
<br>
</div>

<script type="text/javascript">
    $('#profileInformation').hide()
    function requestDetailsFromApi(scannedText) {
        $.ajax({
            type: "GET",
            url: "https://demandid-attendance.herokuapp.com/api/member/details",
            data: {uuid: scannedText},
            cache: false,
            success: function (data) {
                if (data[0] === null) {
                    alert('User does not exist!');
                } else {
                    // console.log(data)
                    document.getElementById('fullname').innerText = data[0].fullname
                    document.getElementById('email').innerText = data[0].email
                    document.getElementById('profession').innerText = data[0].profession
                    document.getElementById('nextOfKinPhoneNumber').innerText = data[0].next_of_kin_phone_number
                    $('#profileInformation').show();
                }
            }
        });
    }




    function onQRCodeScanned(scannedText)
    {
        requestDetailsFromApi(scannedText);
    }

    function provideVideo()
    {
        var n = navigator;

        if (n.mediaDevices && n.mediaDevices.getUserMedia)
        {
            return n.mediaDevices.getUserMedia({
                video: {
                    facingMode: "environment"
                },
                audio: false
            });
        }

        return Promise.reject('Your browser does not support getUserMedia');
    }

    function provideVideoQQ()
    {
        return navigator.mediaDevices.enumerateDevices()
            .then(function(devices) {
                var exCameras = [];
                devices.forEach(function(device) {
                    if (device.kind === 'videoinput') {
                        exCameras.push(device.deviceId)
                    }
                });

                return Promise.resolve(exCameras);
            }).then(function(ids){
                if(ids.length === 0)
                {
                    return Promise.reject('Could not find a webcam');
                }

                return navigator.mediaDevices.getUserMedia({
                    video: {
                        'optional': [{
                            'sourceId': ids.length === 1 ? ids[0] : ids[1]//this way QQ browser opens the rear camera
                        }]
                    }
                });
            });
    }

    //this function will be called when JsQRScanner is ready to use
    function JsQRScannerReady()
    {
        //create a new scanner passing to it a callback function that will be invoked when
        //the scanner succesfully scan a QR code
        var jbScanner = new JsQRScanner(onQRCodeScanned);
        //var jbScanner = new JsQRScanner(onQRCodeScanned, provideVideo);
        //reduce the size of analyzed image to increase performance on mobile devices
        jbScanner.setSnapImageMaxSize(300);
        var scannerParentElement = document.getElementById("scanner");
        if(scannerParentElement)
        {
            //append the jbScanner to an existing DOM element
            jbScanner.appendTo(scannerParentElement);
        }
    }
</script>
</body>
</html>
